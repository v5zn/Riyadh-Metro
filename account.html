<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Riyadh Metro - My Account</title>
    <link rel="icon" href="Pics/1..png">
    <base target="_blank">
    <link rel="stylesheet" href="RiyadhMetro.css">
    <style>

        .form-container {
            margin-top: 30px;
            padding: 40px;
            text-align: left;
            margin-left: 50px;
            flex-grow: 1;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 70%;
            max-width: 800px;
            min-height: 500px;
            margin-bottom: 10px;
            margin-right: 10px;
        }

        .form-container h1 {
            font-size: 24px;
            color: #072211;
            margin-bottom: 15px;
        }

        .info-row input {
            font-size: 16px;
            padding: 8px;
            width: 300px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .change-button {
            cursor: pointer;
            margin-left: 5px;
            font-size: 16px;
            color: #21a953;
            text-decoration: underline;
        }

        .edit-box {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            border: 1px solid #ccc;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            width: 400px;
            text-align: center;
        }

        .edit-box h2 {
            font-size: 20px;
            margin-bottom: 15px;
        }

        .edit-box input {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }

        .edit-box button {
            background-color: #21a953;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px;
            margin-right: 10px;
            font-size: 16px;
        }

        .edit-box button.close {
            background-color: #ee1b14;
        }

    </style>
</head>
<body>
    <div id="head">
        <a href="tickets.html" id="a"><button class="buttons" id="Tickets">Tickets</button></a>
        <a href="line.html" id="a"><button class="buttons">Lines</button></a>
        <a href="Paths.html" id="a"><button class="buttons">Paths</button></a>
        <a href="About.html" id="a"><button class="buttons">About</button></a>
        <a href="Contact.html" id="a"><button class="buttons">Contact</button></a>
        
        <div class="dropdown">
            <button class="dropbtn">Menu</button>
            <div class="dropdown-content">
                <a href="tickets.html">Tickets</a>
                <a href="line.html">Lines</a>
                <a href="Paths.html">Paths</a>
                <a href="About.html">About</a>
                <a href="Contact.html">Contact</a>
            </div>
        </div>
        <div id="Pic">
            <a href="index.html">
                <img src="Pics/drb.png" style="height: 100px;">
            </a>
            <img src="Pics/unii.png" alt="Static Image" style="height: 100px;">
        </div>

    </div>
    <div class="form-container">
        <h1>Personal Information</h1>
        <form>
            <div style="margin: 5px;" class="info-row">
                
                <label for="full-name">Full Name</label>
                <input type="text" id="full-name" placeholder=" " readonly>
                <span class="change-button" onclick="showEditBox('full-name')">Change</span>
                <div id="edit-full-name" class="edit-box">
                    <h2>Change Name</h2>
                    <input type="text" id="edit-full-name-input" placeholder="Enter new name">
                    <button type="button" onclick="updateValue('full-name', 'edit-full-name-input', event)">Update</button>
                    <button type="button" class="close" onclick="closeEditBox('edit-full-name')">Close</button>
                </div>
                <br>
    
            
                <label for="email">Email Address</label>
                <input type="email" id="email" placeholder=" " readonly>
                <span class="change-button" onclick="showEditBox('email')">Change</span>
                <div id="edit-email" class="edit-box">
                    <h2>Change Email</h2>
                    <input type="email" id="edit-email-input" placeholder="Enter new email">
                    <button type="button" onclick="updateValue('email', 'edit-email-input', event)">Update</button>
                    <button type="button" class="close" onclick="closeEditBox('edit-email')">Close</button>
                </div>
                <br>
    
              
                <label for="password">Password</label>
                <input type="password" id="password" placeholder=" " readonly>
                <span class="change-button" onclick="showEditBox('password')">Change</span>
                <div id="edit-password" class="edit-box">
                    <h2>Change Password</h2>
                    <input type="password" id="edit-password-input" placeholder="Enter new password">
                    <button type="button" onclick="updateValue('password', 'edit-password-input', event)">Update</button>
                    <button type="button" class="close" onclick="closeEditBox('edit-password')">Close</button>
                </div>
                <br>
            </div>
        </form>
    
        <button onclick="logout()" style="font-size: 14px; font-weight: 560; margin: 5px; border-radius: 5px; background-color: #ee1b14; color: #fff; padding: 5px 10px;">Logout</button>
    </div>

    <footer>
        <div id="tail">

            <div id="third">
                <p>Download darb app now!</p>
                <div>
                    <a href="https://apps.apple.com/sa/app/darb-%D8%AF%D8%B1%D8%A8/id1549817739"><img src="Pics/as.png" id="pi"></a>
                    <a href="https://play.google.com/store/apps/details?id=com.rcrc.riyadhjourneyplanner"><img src="Pics/gp.png" id="pi"></a>
                </div>
            </div>
    
            <div id="second">
                <div id="t3"> 
                    <a href="line.html"><button class="buttons2">Metro lines</button></a>
                    <a href="Paths.html"><button class="buttons2">Plan your journy</button></a>
                    <a href="tickets.html"><button class="buttons2">Buy a ticket</button></a>
                </div>
    
                <div id="t3">
                    <a href="About.html"><button class="buttons2">About the metro</button></a>
                    <a href="Contact.html"><button class="buttons2">Contact us</button></a>
                </div>
            </div>
    
            <div id="first">
                <div id="t1"><img src="Pics/drb.png" id="drb"></div>
                <div id="t2">
                    <a href="https://www.youtube.com/channel/UCQYmsh8gxjU5HM7gEyRkT5w/community?pvf=CAI%253D"><img src="Pics/youtube.png" id="sm"></a>
                    <a href="https://www.linkedin.com/company/riyadhtransport/"><img src="Pics/linkedin.png" id="sm"></a>
                    <a href="https://www.facebook.com/riyadhtransport"><img src="Pics/facebook.png" id="sm"></a>
                    <a href="https://www.instagram.com/riyadhtransport/"><img src="Pics/instagram.png" id="sm"></a>
                    <a href="https://x.com/RiyadhTransport"><img src="Pics/twitter.png" id="sm"></a>
                </div>
            </div>
    
        </div>
    </footer>

    <script>
        let mybutton = document.getElementById("myBtn");

        window.onscroll = function () { scrollFunction() };

        function scrollFunction() {
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                mybutton.style.display = "block";
            } else {
                mybutton.style.display = "none";
            }
        }

        function topFunction() {
            document.body.scrollTop = 0;
            document.documentElement.scrollTop = 0;
        }

        function showEditBox(fieldId) {
    const editBox = document.getElementById(`edit-${fieldId}`);
    editBox.style.display = 'block';
}

function closeEditBox(editBoxId) {
    const editBox = document.getElementById(editBoxId);
    editBox.style.display = 'none';
}
document.querySelectorAll('.buttons').forEach(button => {
    button.addEventListener('click', function() {
 
        document.querySelectorAll('.buttons').forEach(btn => btn.classList.remove('active-button'));
        
        this.classList.add('active-button');
    });
});


function logout() {
    localStorage.removeItem("user");
    window.location.href = "index.html";
}
function updateValue(fieldId, inputId) { 
    event.preventDefault();
    const inputField = document.getElementById(fieldId);
    const editInput = document.getElementById(inputId);
    const oldValue = inputField.value;
    const newValue = editInput.value;

    if (!newValue.trim()) {
        alert("Please enter a valid value");
        return;
    }

    const user = JSON.parse(localStorage.getItem("user"));
    if (user) {
        const key = fieldId === 'full-name' ? 'username' : fieldId;
        user[key] = newValue;
        localStorage.setItem("user", JSON.stringify(user));
        inputField.value = newValue;

        fetch("http://localhost:3000/update", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ userId: user.id, field: key, value: newValue }),
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert("The update was successfully completed !");
                closeEditBox(`edit-${fieldId}`);
            } else {
                inputField.value = oldValue;
                alert("Update failed!");
            }
        })
        .catch(error => {
            console.error("Error:", error);
            inputField.value = oldValue;
            alert("Update failed!");
        });
    }
}
document.addEventListener("DOMContentLoaded", function() {
    const user = JSON.parse(localStorage.getItem("user"));
    if (user) {
        document.getElementById("full-name").value = user.username || "";
        document.getElementById("email").value = user.email || "";
        document.getElementById("password").value = "it is not your businness";
    } else {
        window.location.href = "login.html";
    }
});

    </script>
</body>
</html>
